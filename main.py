from modules.libraries import pn
from modules.shared import material
from modules.boxplot import boxplot_plot
import requests
from modules.local_databases import _local_databases
from modules.default import general_widgets, options_panel

try:

   # prod keys
    url = ""
    #'https://app-ext-int-api-prod-001.azurewebsites.net/api/v1.0/visualization/participants'
    #'TPpguBP5yiVqGwmBKw7KxjhB2AIBteZDrlHHg4kLcsVxu2Pew3vNnkPjYyiWYURq'
    headers = {
        "api-key": ""
    }
    searchId=pn.state.session_args.get("searchId")
    if not searchId or len(searchId) == 0: 
        raise ValueError("searchId is missing in session arguments")
    params = dict(
        searchId=str(searchId[0].decode("utf-8"))
    )
    # print(params)
    res = requests.get(url, headers=headers, params=params)
    participants = list(res.json())
    # print(participants)
    participants = [
        str(i.split("-", 1)[0] + "-" + i.split("-", 2)[1]) for i in participants
    ]
    participants = list(set(participants))
    _local_databases._local_participant_list["Transcriptomics"] = participants
    # print(_local_participant_list)
    general_widgets.participant_input.v_model = "\n".join(participants)
    general_widgets.participant_input.label = "Participant List (n=" + str(len(participants)) + ")"
    text = "Participant Query was successful"
    print(text)

except Exception:
    text = "participant query failed. Please verify your participants exist in the dataset. Participant list will be defaulted to using all participants."
    print(text)
    pn.state.notifications.error(text, duration=3000)
    # change this code to default to all participants from either transcriptomics or proteomics depending on what is selected in dataset button
    general_widgets.participant_input.v_model = "CASE-NEUAA599TMX\nCASE-NEUAB000NKC\nCASE-NEUAF553MJ3\nCASE-NEUAG603XLK\nCASE-NEUAM655HF7\nCASE-NEUAT234RK6\nCASE-NEUAW157NMJ\nCASE-NEUAX665ZHY\nCASE-NEUBA169GXD\nCASE-NEUBC998WWB\nCASE-NEUBD218YR3\nCASE-NEUBD288RXQ\nCASE-NEUBK117YXL\nCASE-NEUBY734PFR\nCASE-NEUCB613CA9\nCASE-NEUCE965ZGK\nCASE-NEUCF538BRM\nCASE-NEUCN596RR3\nCASE-NEUCU245GBQ\nCASE-NEUDD018KAH\nCASE-NEUDE902GCT\nCASE-NEUDG000ZG5\nCASE-NEUDG272XWC\nCASE-NEUDP155HFH\nCASE-NEUDT709YHN\nCASE-NEUEB422WW0\nCASE-NEUEK191WYC\nCASE-NEUEM720BUU\nCASE-NEUEN017PCJ\nCASE-NEUEN476CLW\nCASE-NEUEU558MNK\nCASE-NEUFB989DT1\nCASE-NEUFH122WN7\nCASE-NEUFV237VCZ\nCASE-NEUFY342UNG\nCASE-NEUGD965XVD\nCASE-NEUGE540TC4\nCASE-NEUGJ081HKR\nCASE-NEUGP781PDU\nCASE-NEUGR121TFD\nCASE-NEUGW326BRV\nCASE-NEUGW340YEB\nCASE-NEUHB491NGF\nCASE-NEUHG644RYB\nCASE-NEUHG791RV5\nCASE-NEUHL999WWT\nCASE-NEUHV216EHA\nCASE-NEUHW530WD8\nCASE-NEUHW590KBH\nCASE-NEUHZ302VU4\nCASE-NEUJA217MTJ\nCASE-NEUJA666PYD\nCASE-NEUJC191RLE\nCASE-NEUJH197AK2\nCASE-NEUJX780XXK\nCASE-NEUJY426MBU\nCASE-NEUJY536DKF\nCASE-NEUKD025JPF\nCASE-NEULA777DBT\nCASE-NEULD354RZB\nCASE-NEULL588ALG\nCASE-NEULP998KDJ\nCASE-NEULY177TTN\nCASE-NEULZ548ZXV\nCASE-NEUME498PCJ\nCASE-NEUMN012EVP\nCASE-NEUMN922PMZ\nCASE-NEUMY871DGF\nCASE-NEUNA248WXL\nCASE-NEUNG326MFP\nCASE-NEUNL415AFW\nCASE-NEUPK546ZLD\nCASE-NEUPN525XEW\nCASE-NEUPR357AUF\nCASE-NEUPR600MBU\nCASE-NEURA639MK8\nCASE-NEURJ362MXH\nCASE-NEURR881FKY\nCASE-NEURX315DYH\nCASE-NEURX909UL6\nCASE-NEUTA057AF6\nCASE-NEUTA689LN5\nCASE-NEUTB230DA3\nCASE-NEUTD713DE3\nCASE-NEUTJ613AH9\nCASE-NEUTN952DDG\nCASE-NEUTU360YJY\nCASE-NEUUE852BB1\nCASE-NEUVF888UHM\nCASE-NEUVJ560JGZ\nCASE-NEUVL876PUV\nCASE-NEUVM674HUA\nCASE-NEUVN746WKV\nCASE-NEUVR636VTP\nCASE-NEUVW680LPK\nCASE-NEUVW999FP9\nCASE-NEUVX902YNL\nCASE-NEUWD538KT3\nCASE-NEUWH380YHV\nCASE-NEUWJ389FC7\nCASE-NEUXP289KRC\nCASE-NEUXP595FFP\nCASE-NEUXV122FN3\nCASE-NEUXX361RUG\nCASE-NEUYG298CA9\nCASE-NEUYH924UCE\nCASE-NEUYK029WUU\nCASE-NEUYL008GM4\nCASE-NEUYL149PRF\nCASE-NEUYP235ZLD\nCASE-NEUYY225MNZ\nCASE-NEUYY878JGP\nCASE-NEUZN836GME\nCASE-NEUZN936HJ9\nCASE-NEUZP278MR4\nCASE-NEUZT557DHF\nCASE-NEUZV656DD1\nCASE-NEUZX521TKK\nCASE-NEUZX847VWV\nCTRL-NEUAJ025JC3\nCTRL-NEUAJ928PAA\nCTRL-NEUCA748GF2\nCTRL-NEUCV136DHM\nCTRL-NEUCV809LL4\nCTRL-NEUDE949BP3\nCTRL-NEUDM126GNG\nCTRL-NEUEU392AE8\nCTRL-NEUEY565NWT\nCTRL-NEUFE306EFY\nCTRL-NEUFZ500KDB\nCTRL-NEUFZ508VBV\nCTRL-NEUHE723FGT\nCTRL-NEUJH290RH7\nCTRL-NEUJX341NDP\nCTRL-NEUKW131XJ2\nCTRL-NEULL933JXY\nCTRL-NEUMN061ATZ\nCTRL-NEUNW343RXP\nCTRL-NEUPH301NNX\nCTRL-NEURJ861MMD\nCTRL-NEUUV825HYF\nCTRL-NEUVZ050YX7\nCTRL-NEUWT164JRQ\nCTRL-NEUYM205MRL\nCASE-NEUAE228FF6\nCASE-NEUAE993EPR\nCASE-NEUAG241NUD\nCASE-NEUAG766ULB\nCASE-NEUAL076FCE\nCASE-NEUAP285GGU\nCASE-NEUAW717TN6\nCASE-NEUAY067UTB\nCASE-NEUAZ394JEZ\nCASE-NEUBC901KL3\nCASE-NEUBD141MGD\nCASE-NEUBM949LA5\nCASE-NEUBN979ZZ5\nCASE-NEUBT273FH3\nCASE-NEUBW008RJ5\nCASE-NEUCD502BFU\nCASE-NEUCG511MJ6\nCASE-NEUCP218XVV\nCASE-NEUCT022VTK\nCASE-NEUCT842RJV\nCASE-NEUCU076ADN\nCASE-NEUCV578DFJ\nCASE-NEUDH063DEA\nCASE-NEUDM949BAR\nCASE-NEUDY534KGP\nCASE-NEUDZ473EGM\nCASE-NEUEC400NYR\nCASE-NEUEM029XXZ\nCASE-NEUET072VDG\nCASE-NEUEU318NY2\nCASE-NEUEY478NZP\nCASE-NEUFH461AAN\nCASE-NEUFU395MJD\nCASE-NEUFX386KMB\nCASE-NEUGH995TFK\nCASE-NEUGL543NJ1\nCASE-NEUGR539MVT\nCASE-NEUHK991AVP\nCASE-NEUHL096UF0\nCASE-NEUHL814WMU\nCASE-NEUHM532NDD\nCASE-NEUHT569HT1\nCASE-NEUHY206ZEQ\nCASE-NEUJG311WGV\nCASE-NEUJG885PY7\nCASE-NEUJK720JCL\nCASE-NEUJL547WVQ\nCASE-NEUJL595JAZ\nCASE-NEUJP935AVF\nCASE-NEUJX990GR5\nCASE-NEUKA860NUG\nCASE-NEUKP160HX8\nCASE-NEUKR376CW3\nCASE-NEUKV547CFA\nCASE-NEUKY704JVA\nCASE-NEULA694DDC\nCASE-NEULH729AU2\nCASE-NEULL648LJ1\nCASE-NEULM691PBK\nCASE-NEULT851ENP\nCASE-NEULY328CRJ\nCASE-NEUMB242CLN\nCASE-NEUMH634MKT\nCASE-NEUMW598YMT\nCASE-NEUNJ155KYL\nCASE-NEUNJ938DUL\nCASE-NEUNL303HLF\nCASE-NEUNR020KV6\nCASE-NEUNZ171UYF\nCASE-NEUPG593UTV\nCASE-NEUPM937TMY\nCASE-NEUPY050ANK\nCASE-NEURF720KHA\nCASE-NEUTC791PVE\nCASE-NEUTD314VFT\nCASE-NEUTD866EAH\nCASE-NEUTL257PNR\nCASE-NEUTL699WJ0\nCASE-NEUTM934BPY\nCASE-NEUUC458RFT\nCASE-NEUUD158CJF\nCASE-NEUUF613PHL\nCASE-NEUUH658EYH\nCASE-NEUUJ507EAB\nCASE-NEUUL256UC9\nCASE-NEUUL292XRC\nCASE-NEUUL311NRQ\nCASE-NEUUP280KXL\nCASE-NEUUU506WZF\nCASE-NEUUZ216XY8\nCASE-NEUVD687XD8\nCASE-NEUVP060WFG\nCASE-NEUVR814YCY\nCASE-NEUVU735HU6\nCASE-NEUVV225XKB\nCASE-NEUWD946RDA\nCASE-NEUWH955FJF\nCASE-NEUWM344ZLM\nCASE-NEUWP426NBR\nCASE-NEUWX167DAH\nCASE-NEUWY079WUH\nCASE-NEUWZ614ARQ\nCASE-NEUXD985ZU1\nCASE-NEUXE491RMM\nCASE-NEUXG265ME9\nCASE-NEUXH833LL4\nCASE-NEUXP495XE2\nCASE-NEUYC055XPZ\nCASE-NEUYC198DCR\nCASE-NEUYC303AJY\nCASE-NEUYD306HAB\nCASE-NEUYG208KVV\nCASE-NEUYJ705VN9\nCASE-NEUYP226CPW\nCASE-NEUYT193FFG\nCASE-NEUYY614DN8\nCASE-NEUZD231YZ6\nCASE-NEUZE432DZM\nCASE-NEUZF321EW4\nCASE-NEUZF473UEP\nCASE-NEUZJ053JGZ\nCASE-NEUZK054DP5\nCASE-NEUZT902WVB\nCASE-NEUZW701NNF\nCASE-NEUZY128BJ2\nCASE-NEUZY975XKL\nCTRL-NEUAA485DZL\nCTRL-NEUDA782GW3\nCTRL-NEUDT762KUL\nCTRL-NEUEB210XRC\nCTRL-NEUFL733GX5\nCTRL-NEUHZ716BZ2\nCTRL-NEUMA002VLD\nCTRL-NEUMF089KLV\nCTRL-NEUML507PFJ\nCTRL-NEUMT184NWC\nCTRL-NEUNC876ZB2\nCTRL-NEUNN472ACB\nCTRL-NEUPL878MTL\nCTRL-NEUPW536ZKZ\nCTRL-NEURV546WMW\nCTRL-NEUWN092BVG\nCTRL-NEUXC258VTR\nCTRL-NEUXP955XW7\nCTRL-NEUXW311EFC\nCTRL-NEUZL045YD3"



# Add some content to the modal area
material.modal.append(pn.Column())
material.sidebar.append(pn.Column(options_panel.options_panel))

material.main.append(
    # page
    pn.Row(boxplot_plot.boxplot, height=1000, visible=True)
)
material.servable()
